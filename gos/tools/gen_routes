#!/usr/bin/env ruby

require "yaml"

source = "./src/config/routes.yml"
target = "./src/app/register/register_routes.go"

defines = YAML.load_file(source)

contents = ""

defines.each do |key, value|
  chunks = key.split("#")
  controller = chunks[0]
  handler = chunks[1]
  contents << %Q{\
    routes.Add("#{value}", func(ctx interface{}, params interface{}) (string, interface{}) {
        instance := &controllers.#{controller}{Ctx: ctx.(*gslib.Player)}
        return instance.#{handler}(params.(*#{value}))
    })
}
end

File.open(target, "w") do |io|
  io.write %Q{\
// Generated by tools/gen_routes

package register

import (
	. "app/consts"
	"app/controllers"
	"gslib"
	"gslib/routes"
)

func Load() {
#{contents}
}
}
end
